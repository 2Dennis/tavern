---
name: Test schema
desc: Matches test blocks

# http://www.kuwata-lab.com/kwalify/ruby/users-guide.01.html
# https://pykwalify.readthedocs.io/en/unstable/validation-rules.html


schema;any_map_with_ext_function:
  # Anchor matches any key: value, and if there's an $ext function
  # in it it will check that it can be loaded at schema validation
  # time instead of run time. This means there can be both
  # checking for key: value matches as well as passing it to a
  # function for more advanced manipulation
  func: validate_extensions
  type: map
  required: false
  mapping:
    re;(.*):
      type: any

schema;any_map_or_list_with_ext_function:
  # Similar, but we want to match lists or dicts
  func: validate_json_with_extensions
  type: any
  required: false


type: map
mapping:
  test_name:
    required: true
    type: str

  includes:
    required: false
    type: seq
    sequence:
      - type: map
        required: false
        mapping:
          name:
            required: true
            type: str

          description:
            required: true
            type: str

          variables:
            type: map
            required: false
            mapping:
              re;(.*):
                type: any

  stages:
    type: seq
    required: true
    sequence:
      - type: map
        required: true
        mapping:
          name:
            type: str
            required: true
            unique: true

          delay_before:
            type: float
            required: false
            unique: true

          delay_after:
            type: float
            required: false
            unique: true
